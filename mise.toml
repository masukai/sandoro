# mise.toml - sandoro プロジェクト設定
#
# ポモドーロタイマー (CLI版: Rust, Web版: React)

min_version = "2025.10.0"

# ==========================================
# ツール定義
# ==========================================

[tools]
# === 必須ツール ===
gh = "2.81.0"        # GitHub CLI

# === CLI版 (Rust) ===
rust = "1.92"        # Rust 言語（2026-01現在の最新安定版）

# === Web版 (React) ===
node = "24"          # Node.js Active LTS（EOL: 2028-04）
pnpm = "10"          # パッケージマネージャー最新版

# === Backend (Supabase) ===
"aqua:supabase/cli" = "2.72.7"  # Supabase CLI

# ==========================================
# 環境変数
# ==========================================

[env]
SANDORO_ENV = "development"
_.file = [".env.supabase"]  # Load Supabase access token if exists

# ==========================================
# タスク定義
# ==========================================

[tasks]

# === GitHub CLI ===
"gh:auth" = "gh auth status || gh auth login"
"gh:pr"   = "gh pr create --base main --web"

# === CLI版 (Rust) ===
"dev-cli"   = { run = "cargo run", dir = "cli", description = "Run CLI in development" }
"cli-help"  = { run = "cargo run -- --help", dir = "cli", description = "Show CLI help and privacy info" }
"stats-cli" = { run = "cargo run -- stats", dir = "cli", description = "Show CLI stats (today)" }
"stats-cli:week" = { run = "cargo run -- stats --week", dir = "cli", description = "Show CLI stats (week)" }
"stats-cli:month" = { run = "cargo run -- stats --month", dir = "cli", description = "Show CLI stats (month)" }
"stats-cli:interactive" = { run = "cargo run -- stats --interactive", dir = "cli", description = "Interactive heatmap navigation" }
"stats-cli:export-json" = { run = "cargo run -- stats --export json", dir = "cli", description = "Export sessions to JSON" }
"stats-cli:export-csv" = { run = "cargo run -- stats --export csv", dir = "cli", description = "Export sessions to CSV" }

# === CLI版 クラウド同期 ===
"cli:login" = { run = "cargo run -- login --provider google", dir = "cli", description = "Login to cloud sync (Google)" }
"cli:logout" = { run = "cargo run -- logout", dir = "cli", description = "Logout from cloud sync" }
"cli:sync" = { run = "cargo run -- sync", dir = "cli", description = "Sync sessions with cloud" }
"cli:status" = { run = "cargo run -- status", dir = "cli", description = "Show sync status" }

"build-cli" = { run = "cargo build --release", dir = "cli", description = "Build CLI release" }
"test-cli"  = { run = "cargo test", dir = "cli", description = "Run CLI tests" }
"lint-cli"  = { run = "cargo clippy -- -D warnings", dir = "cli", description = "Run Clippy linter" }
"fmt-cli"   = { run = "cargo fmt", dir = "cli", description = "Format Rust code" }

# === Web版 (React) ===
"dev-web"   = { run = "pnpm dev", dir = "web", description = "Run Web in development" }
"build-web" = { run = "pnpm build", dir = "web", description = "Build Web for production" }
"test-web"  = { run = "pnpm test", dir = "web", description = "Run Web tests" }
"lint-web"  = { run = "pnpm lint", dir = "web", description = "Run ESLint" }
"install-web" = { run = "pnpm install", dir = "web", description = "Install Web dependencies" }

# === Supabase ===
"supabase:start" = { run = "supabase start", description = "Start local Supabase" }
"supabase:stop" = { run = "supabase stop", description = "Stop local Supabase" }
"supabase:status" = { run = "supabase status", description = "Show Supabase status" }
"supabase:link" = { run = "supabase link --project-ref ukjsssbpfvkumflzcfrd", description = "Link to remote Supabase project" }
"supabase:migrate" = { run = "supabase db push", description = "Push migrations to remote" }
"supabase:reset" = { run = "supabase db reset", description = "Reset local database" }
"supabase:types" = { run = "supabase gen types typescript --project-id ukjsssbpfvkumflzcfrd > web/src/lib/database.types.ts", description = "Generate TypeScript types" }

# === 全体 ===
"test" = """
cd cli && cargo test && \
cd ../web && pnpm test
"""

"lint" = """
cd cli && cargo clippy -- -D warnings && \
cd ../web && pnpm lint
"""

# === リリースビルド ===
"release" = """
cd cli && \
cargo build --release --target x86_64-apple-darwin && \
cargo build --release --target aarch64-apple-darwin
"""
